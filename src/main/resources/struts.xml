<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE struts PUBLIC
"-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
"http://struts.apache.org/dtds/struts-2.0.dtd">

<struts>

	<constant name="struts.enable.DynamicMethodInvocation" value="false" />
	<!-- devMode is helpful when you want some extra logs for debugging -->
	<constant name="struts.devMode" value="true" />


	<!-- Global message resource; Otherwise you will have seperate message resource 
		for each Action -->
	<constant name="struts.custom.i18n.resources" value="messages" />


	<!-- This is important if you are planning to have slashes in Action URLs 
		e.g. In this demo, employee is deleted using URL /delete/10 This this is 
		set to false; then struts will try to find mapping for URL "/10" instaed 
		of "/delete/10" -->
	<constant name="struts.enable.SlashesInActionNames" value="true" />


	<!-- set the bootstrap theme as the default one -->
	<constant name="struts.ui.theme" value="simple" />


	<!-- Normal Action mappings are defined here -->
	<package name="musee" namespace="/" extends="struts-default">



		<!-- Two things to Notice: 1) class is set to 'editEmployeeAction' which 
			is bean defined by Spring context 2) We have given the method to be called 
			here as well; -->
		<!-- ResultType pour récupérer afficher les photos chez le client -->
		<result-types>
			<result-type name="imageResult"
				class="com.projetdar.controller.CustomImageBytesResult" />
		</result-types>

		<interceptors>
			<interceptor name="authentication"
				class="com.projetdar.interceptors.AuhtenticationInterceptor"></interceptor>
			<interceptor-stack name="authStack">
				<interceptor-ref name="authentication"></interceptor-ref>
				<interceptor-ref name="defaultStack">
					<param name="exception.logEnabled">true</param>
					<param name="exception.logLevel">ERROR</param>
				</interceptor-ref>
			</interceptor-stack>
		</interceptors>

		<!-- <default-interceptor-ref name="authStack"></default-interceptor-ref> -->


		<global-results>
			<result name="error">/view/error.jsp</result>
		</global-results>
		<global-exception-mappings>
			<exception-mapping exception="java.lang.Exception"
				result="error" />
			<exception-mapping exception="java.lang.ArithmeticException"
				result="error" />
			<exception-mapping exception="java.lang.ArrayIndexOutOfBoundsException"
				result="error" />
			<exception-mapping exception="java.lang.ArrayStoreException"
				result="error" />
			<exception-mapping exception="java.lang.ClassCastException"
				result="error" />
			<exception-mapping exception="java.lang.IllegalArgumentException"
				result="error" />
			<exception-mapping exception="java.lang.IllegalMonitorStateException"
				result="error" />
			<exception-mapping exception="java.lang.IllegalStateException"
				result="error" />
			<exception-mapping exception="java.lang.IllegalThreadStateException"
				result="error" />
			<exception-mapping exception="java.lang.IndexOutOfBoundsException"
				result="error" />
			<exception-mapping exception="java.lang.NegativeArraySizeException"
				result="error" />
			<exception-mapping exception="java.lang.NullPointerException"
				result="error" />
			<exception-mapping exception="java.lang.NumberFormatException"
				result="error" />
			<exception-mapping exception="java.lang.SecurityException"
				result="error" />
			<exception-mapping exception="java.lang.StringIndexOutOfBounds"
				result="error" />
			<exception-mapping exception="java.lang.UnsupportedOperationException"
				result="error" />
			<exception-mapping exception="java.lang.ClassNotFoundException"
				result="error" />
			<exception-mapping exception="java.lang.CloneNotSupportedException"
				result="error" />
			<exception-mapping exception="java.lang.IllegalAccessException"
				result="error" />
			<exception-mapping exception="java.lang.InstantiationException"
				result="error" />
			<exception-mapping exception="java.lang.InterruptedException"
				result="error" />
			<exception-mapping exception="java.lang.NoSuchFieldException"
				result="error" />
			<exception-mapping exception="java.lang.NoSuchMethodException"
				result="error" />
		</global-exception-mappings>

		<action name="list" class="editMuseeAction" method="listMusees">
			<result>/view/listMusees.jsp</result>
		</action>
		<!-- les actions de la connextion et la déconnexion -->
		<action name="login" class="loginAction">
			<interceptor-ref name="defaultStack"></interceptor-ref>
			<result name="error">/view/listMusees.jsp</result>
			<result name="success" type="redirect">/list</result>
			<result name="input" type="redirect">/list</result>
		</action>
		<action name="deconnexion" class="loginAction" method="deleteSession">
			<result name="success" type="redirect">/list</result>
		</action>
		<!-- l'action pour récupérer une image -->
		<action name="ImageAction" class="imageAction">

			<result name="success" type="imageResult">
			</result>
		</action>

		<action name="editMusees" class="editMuseeAction" method="editMusees">
			<interceptor-ref name="authStack" />
			<result name="login">/view/login.jsp</result>
			<result name="success">/view/backOffice.jsp</result>
		</action>
		<!-- lees actions relatives à l'entité musée : Récupération, modification, 
			suppression ( l'ajout, la modification et la suppression est dédiée pour 
			les admins, d'ou l'appel de l'intercepteur authStack) -->
		<action name="show" class="editMuseeAction" method="showMusee">
			<result name="success">/view/showMusee.jsp</result>
		</action>
		<action name="add" class="editMuseeAction" method="addMusee">
			<interceptor-ref name="authStack" />
			<result name="login">/view/login.jsp</result>
			<result name="success">/view/addMusee.jsp</result>
		</action>
		<action name="saveAdd" class="editMuseeAction" method="saveAddMusee">
			<interceptor-ref name="authStack" />
			<interceptor-ref name="fileUpload">
				<param name="maximumSize">2097152</param>
				<param name="allowedTypes">
					image/png,image/gif,image/jpeg,image/pjpeg
				</param>
			</interceptor-ref>
			<interceptor-ref name="defaultStack"></interceptor-ref>
			<result name="login">/view/login.jsp</result>
			<result name="success" type="redirect">/editMusees</result>
		</action>
		<action name="update" class="editMuseeAction" method="updateMusee">
			<interceptor-ref name="authStack" />
			<result name="login">/view/login.jsp</result>
			<result name="success">/view/updateMusee.jsp</result>
		</action>
		<action name="saveUpdate" class="editMuseeAction" method="saveUpdateMusee">
			<interceptor-ref name="authStack" />
			<result name="login">/view/login.jsp</result>
			<result name="success" type="redirect">/editMusees</result>
		</action>
		<action name="delete/*" class="editMuseeAction" method="deleteMusee">
			<!-- <param name="musee.idMusee">{1}</param> -->
			<interceptor-ref name="authStack" />
			<result name="login">/view/login.jsp</result>
			<result type="redirect">/list</result>
		</action>
		<action name="*" class="editMuseeAction" method="listMusees">
			<result>/view/listMusees.jsp</result>
		</action>
		<!-- Les actions pour les avis : ajouter et supprimer un avis ( la suppression 
			est dédiée pour les admins, d'ou l'appel de l'intercepteur authStack) -->
		<action name="postAvis" class="editMuseeAction" method="postAvis">
			<result name="success" type="redirect">/list</result>
		</action>
		<action name="deleteAvis" class="editMuseeAction" method="deleteAvis">
			<interceptor-ref name="authStack" />
			<result name="login">/view/login.jsp</result>
			<result type="redirect">/list</result>
		</action>
	</package>

</struts>